function load_files(e){$.blockUI({css:{backgroundColor:"none",border:"none",color:"#fff"},message:"Loading...",timeout:1e3});$.post("index.php?action=LOAD_FILES",{path:e},function(e){$("#files-container").html(e)}).success(function(){}).error(function(){}).complete(function(){})}$(document).ajaxStop($.unblockUI);$(document).ready(function(){var e="";$("#files-container").on("click",".folder, .bread-path",function(t){t.preventDefault();e=$(this).attr("data-path");load_files(e)});$("#new-folder-button").click(function(e){e.preventDefault();$(".new-folder-modal").modal("show");$("#new-folder-name").focus()});$("#add-new-folder-button").click(function(t){t.preventDefault();var n=$("#new-folder-name").val(),r=$("#current-location").val();e="/"+r;if(n.length<1)return!1;$.post("index.php?action=CREATE_FOLDER",{path:e,new_folder:n},function(){}).success(function(){$("#new-folder-name").val("");$(".new-folder-modal").modal("hide");load_files(e)}).error(function(){}).complete(function(){})});$("#cancel-new-folder").click(function(e){e.preventDefault();$("#new-folder-name").val("");$(".new-folder-modal").modal("hide")});$(".new-folder-modal").on("hidden",function(){$("#new-folder-name").val("")});$("#files-container").on("click",".delete-folder, .delete-file",function(t){t.preventDefault();e=$(this).attr("data-path");var n=$(this).attr("data-type");if(n=="dir")var r=confirm("Are you sure you want to delete this folder?\nAll files and folders inside this folder will be deleted too.");else var r=confirm("Are you sure you want to delete this file? All additional thumbnails and sizes associated with this image will be deleted too.");r===!0&&$.post("index.php?action=DELETE_FOLDER",{path:e,file_type:n},function(e){}).success(function(){$(t.target).parent().parent().parent().fadeOut("slow")}).error(function(){}).complete(function(){})});$("#files-container").on("click",".view-img-sibs",function(t){t.preventDefault();e=$(this).attr("data-path");$("#image-options").load("index.php?action=IMAGE_OPTIONS",{path:e});$(".image-options-modal").modal("show")});$("#cancel-image-options").click(function(e){e.preventDefault();$("#image-options").html("");$(".image-options-modal").modal("hide")});$("#files-container").on("click",".edit-file",function(e){e.preventDefault();var t=$(this).attr("data-path");$("#file-to-edit").load("index.php?action=EDIT_IMAGE",{path:t});$(".file-edit-modal").modal("show")});$(".file-edit-modal").on("hidden",function(){$("#file-to-edit").html("")});$("#cancel-crop").click(function(e){e.preventDefault();$("#file-to-edit").html("");$(".file-edit-modal").modal("hide")});$("#rename-folder-button").click(function(t){t.preventDefault();var n=$("#folder-name").val();n.length>2&&$.post("index.php?action=EDIT_FOLDER",{path:e,folder_name:n},function(){}).success(function(){$("#folder-name").val("");var e=$("#current-location").val();curr_path="/"+e;load_files(curr_path);$(".folder-name-modal").modal("hide")}).error(function(){}).complete(function(){})});$("#files-container").on("click",".edit-dir",function(e){e.preventDefault();var t=$(this).attr("data-path");$(".folder-name-modal").modal("show")});$("#cancel-rename-folder").click(function(e){e.preventDefault();$("#folder-name").val("");$(".folder-name-modal").modal("hide")});$(".folder-name-modal").on("hidden",function(){$("#folder-name").val("")});load_files(e);$(".uploader-modal").modal("hide");$("#upload-modal-button").click(function(e){e.preventDefault();var t=$("#current-location").val();t.length==0&&(t="home");$("#uploading-location").html("Uploading to: "+t);$(".uploader-modal").modal("show")});$(".uploader-modal").on("hidden",function(){$("#uploadfiles").hide();$("#cancelfile").hide();$("#filelist").html('<span class="no-files-selected">No file selected</span>');$(".upload-error").hide();$(".upload-error .notify-inner").html("");if(t){$.each(t.files,function(e,n){t.removeFile(n.id)});t.refresh();t.splice()}});var t=new plupload.Uploader({runtimes:"html5,flash,silverlight",browse_button:"pickfile",multipart:!0,drop_element:"filedrop",max_file_size:"10mb",unique_names:!0,url:"index.php",flash_swf_url:"js/plupload.flash.swf",silverlight_xap_url:"js/plupload.silverlight.xap",filters:[{title:"Image files",extensions:"jpg,jpeg,png,gif"},{title:"Documents",extensions:"doc,docx,xls,xlsx,ppt,pages,numbers,rtf,txt,pdf,zip,tar,exe,dmg"}]});t.bind("Init",function(e,t){$("#filelist").html('<span class="no-files-selected">No file selected</span>')});t.bind("FilesAdded",function(e,n){$.each(n,function(e,n){$(".no-files-selected").remove();$("#filelist").append('<div id="'+n.id+'">'+n.name+" ("+plupload.formatSize(n.size)+') <a href="#" class="upload-delete"><i class="icon-remove"></i></a>'+"</div>");$("#"+n.id+" .upload-delete").click(function(e){$("#"+n.id).remove();t.removeFile(n);e.preventDefault()})});$("#uploadfiles").show();$("#custom-sizes").show()});t.bind("Error",function(e,t){$(".upload-error").show();$(".upload-error .notify-inner").append("<p>Error: "+t.code+", Message: "+t.message+(t.file?", File: "+t.file.name:"")+"</p>");e.refresh()});t.bind("UploadProgress",function(e,t){$("#upload-progress").css("width",t.percent+"%")});t.bind("BeforeUpload",function(e,n){var r=$("#custom-width").val(),i=$("#custom-height").val();t.settings.multipart_params={path:$("#current-location").val(),action:"UPLOAD_FILE",custom_width:r,custom_height:i}});t.bind("FileUploaded",function(e,n,r){var i=$.parseJSON(r.response);if(i.error){$("#error").html("<div><strong>Error: "+i.error.message+"</strong></div>");e.refresh();return!1}$("#upload-progress").css("width","5px");$(".upload-error").hide();$(".upload-error .notify-inner").html("");$("#uploadfiles").hide();$("#custom-sizes").hide();t.refresh()});t.bind("UploadComplete",function(e,n){var r=$("#current-location").val(),i="/"+r;$("#custom-width").val("");$("#custom-height").val("");load_files(i);$.each(t.files,function(e,n){t.removeFile(n.id)});t.refresh();$("#filelist").html("<strong>Upload complete.</strong>");$(".upload-error").hide();$(".upload-error .notify-inner").html("");$("#uploadfiles").hide();$("#custom-sizes").hide()});$("#uploadfiles").click(function(e){t.start();e.preventDefault()});$("body").on("click","#cancelfile",function(e){$("#uploadfiles").hide();$(".upload-error").hide();$(".upload-error .notify-inner").html("");$(".uploader-modal").modal("hide");$.each(t.files,function(e,n){t.removeFile(n.id)});$("#filelist").html('<span class="no-files-selected">No file selected</span>');t.refresh();t.splice();e.preventDefault()});t.init();$("#filedrop").hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")})});