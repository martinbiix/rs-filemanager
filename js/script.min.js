function load_files(e){$.blockUI({css:{backgroundColor:"none",border:"none",color:"#fff"},message:"Loading...",timeout:1e3,fadeIn:100,fadeOut:100});$.post("index.php?action=LOAD_FILES",{path:e},function(e){$("#files-container").html(e)}).success(function(){}).error(function(){}).complete(function(){})}function reload_edit_image(e){$("#file-to-edit").load("index.php?action=EDIT_IMAGE",{path:e})}function showCoords(e){crop_x=e.x;crop_y=e.y;crop_x2=e.x2;crop_y2=e.y2;crop_width=e.w;crop_height=e.h;$("#w").html(crop_width);$("#h").html(crop_height)}function image_crop(){jcrop_api=null;jcrop_api=$.Jcrop("#edit-image");jcrop_api.setOptions({onChange:showCoords,onSelect:showCoords,minSize:[crop_minWidth,crop_minHeight],maxSize:[crop_maxWidth,crop_maxHeight]});jcrop_api.enable();$("#save-crop-image-button").click(function(e){e.preventDefault();var t=$("#crop-path").val();$("#image-options").html("Reloading images...");$.post("index.php?action=CROP_IMAGE",{w:crop_width,h:crop_height,x:crop_x,y:crop_y,x2:crop_x2,y2:crop_y2,path:t},function(){}).success(function(e){var t=jQuery.parseJSON(e);$("#file-to-edit").html('<p><img src="'+t.cropped_image+'"></p><input type="hidden" id="crop-path"  value="'+t.path+'">');$("#edit-image-message").html("Cropped Saved")}).error(function(){}).complete(function(){$("#image-options").load("index.php?action=IMAGE_OPTIONS",{path:t})})})}var jcrop_api,crop_x="",crop_y="",crop_x2="",crop_y2="",crop_width="",crop_height="";$(document).ajaxStop($.unblockUI);$(document).ready(function(){var e="";$("#files-container").on("click",".folder, .bread-path",function(t){t.preventDefault();e=$(this).attr("data-path");load_files(e)});$("#new-folder-button").click(function(e){e.preventDefault();$(".new-folder-modal").modal("show");$("#new-folder-name").focus()});$("#add-new-folder-button").click(function(t){t.preventDefault();var n=$("#new-folder-name").val(),r=$("#current-location").val();e="/"+r;if(n.length<1)return!1;$.post("index.php?action=CREATE_FOLDER",{path:e,new_folder:n},function(){}).success(function(){$("#new-folder-name").val("");$(".new-folder-modal").modal("hide");load_files(e)}).error(function(){alert("Folder already exists in this location. Please try another name.")}).complete(function(){})});$("#cancel-new-folder").click(function(e){e.preventDefault();$("#new-folder-name").val("");$(".new-folder-modal").modal("hide")});$(".new-folder-modal").on("hidden",function(){$("#new-folder-name").val("")});$("#files-container").on("click",".delete-folder, .delete-file",function(t){t.preventDefault();e=$(this).attr("data-path");var n=$(this).attr("data-type"),r;n==="dir"?r=confirm("Are you sure you want to delete this folder?\nAll files and folders inside this folder will be deleted too."):r=confirm("Are you sure you want to delete this file? All additional thumbnails and sizes associated with this image will be deleted too.");r===!0&&$.post("index.php?action=DELETE_FOLDER",{path:e,file_type:n},function(){}).success(function(){$(t.target).parent().parent().parent().fadeOut("slow")}).error(function(){}).complete(function(){})});$("body").on("click",".delete-custom-image",function(t){t.preventDefault();e=$(this).attr("data-path");var n=confirm("Are you sure you want to delete this image?");n===!0&&$.post("index.php?action=DELETE_CUSTOM_IMAGE",{path:e},function(){}).success(function(){$(t.target).parent().parent().parent().fadeOut("slow")}).error(function(){}).complete(function(){})});$("#files-container").on("click",".view-img-sibs, .edit-file",function(e){e.preventDefault();var t=$(this).attr("data-path");$("#image-options").load("index.php?action=IMAGE_OPTIONS",{path:t});$("#file-to-edit").load("index.php?action=EDIT_IMAGE",{path:t});$(".file-edit-modal").modal("show")});$(".file-edit-modal").on("hidden",function(){$("#file-to-edit").html("");$("#image-options").html("");$("#edit-image-message").html("")});$("#cancel-crop").click(function(e){e.preventDefault();$("#file-to-edit").html("");$("#image-options").html("");$(".file-edit-modal").modal("hide");$("#edit-image-message").html("")});$("body").on("click",".edit-file-option",function(e){e.preventDefault();$("#file-to-edit").html("Loading image...");var t=$(this).attr("data-path");$("#file-to-edit").load("index.php?action=EDIT_IMAGE",{path:t})});$("body").on("click","#crop-image-button",function(e){e.preventDefault();image_crop()});$("#rename-folder-button").click(function(t){t.preventDefault();var n=$("#folder-name").val();n.length>2&&$.post("index.php?action=EDIT_FOLDER",{path:e,folder_name:n},function(){}).success(function(){$("#folder-name").val("");var e=$("#current-location").val();curr_path="/"+e;load_files(curr_path);$(".folder-name-modal").modal("hide")}).error(function(e,t,n){alert("Folder already exists in this location. Please try another name.")}).complete(function(){})});$("#files-container").on("click",".edit-dir",function(t){t.preventDefault();e=$(this).attr("data-path");$(".folder-name-modal").modal("show")});$("#cancel-rename-folder").click(function(e){e.preventDefault();$("#folder-name").val("");$(".folder-name-modal").modal("hide")});$(".folder-name-modal").on("hidden",function(){$("#folder-name").val("")});$("#rotate-image").click(function(e){e.preventDefault();$("#edit-image-message").html("");var t=$("#crop-path").val();$("#file-to-edit").html("<p>Rotating image...</p>");$.post("index.php?action=ROTATE_IMAGE",{path:t},function(){}).success(function(){reload_edit_image(t)}).error(function(){}).complete(function(){})});load_files(e);$(".uploader-modal").modal("hide");$("#upload-modal-button").click(function(e){e.preventDefault();var t=$("#current-location").val();t.length===0&&(t="home");$("#uploading-location").html("Uploading to: "+t);$(".uploader-modal").modal("show")});$(".uploader-modal").on("hidden",function(){$("#uploadfiles").hide();$("#custom-sizes").hide();$("#filelist").html('<span class="no-files-selected">No file selected</span>');$(".upload-error").hide();$(".upload-error .notify-inner").html("");if(uploader){$.each(uploader.files,function(e,t){uploader.removeFile(t.id)});uploader.refresh();uploader.splice()}});uploader.bind("Init",function(e,t){$("#filelist").html('<span class="no-files-selected">No file selected</span>')});uploader.bind("FilesAdded",function(e,t){$.each(t,function(e,t){$(".no-files-selected").remove();$("#filelist").append('<div id="'+t.id+'">'+t.name+" ("+plupload.formatSize(t.size)+') <a href="#" class="upload-delete"><i class="icon-remove"></i></a>'+"</div>");$("#"+t.id+" .upload-delete").click(function(e){$("#"+t.id).remove();uploader.removeFile(t);e.preventDefault()})});$("#uploadfiles").show();$("#custom-sizes").show()});uploader.bind("Error",function(e,t){$(".upload-error").show();$(".upload-error .notify-inner").append("<p>Error: "+t.code+", Message: "+t.message+(t.file?", File: "+t.file.name:"")+"</p>");e.refresh()});uploader.bind("UploadProgress",function(e,t){$("#upload-progress").css("width",t.percent+"%")});uploader.bind("BeforeUpload",function(e,t){var n=$("#custom-width").val(),r=$("#custom-height").val();uploader.settings.multipart_params={path:$("#current-location").val(),action:"UPLOAD_FILE",custom_width:n,custom_height:r}});uploader.bind("FileUploaded",function(e,t,n){var r=$.parseJSON(n.response);if(r.error){$(".upload-error").show();$(".upload-error .notify-inner").html("<p><span class='bold'>Error:</span> "+r.error.message+"</p>");e.refresh();return!1}$("#upload-progress").css("width","5px");$(".upload-error").hide();$(".upload-error .notify-inner").html("");$("#uploadfiles").hide();$("#custom-sizes").hide();uploader.refresh()});uploader.bind("UploadComplete",function(e,t){var n=$("#current-location").val(),r="/"+n;$("#custom-width").val("");$("#custom-height").val("");load_files(r);$.each(uploader.files,function(e,t){uploader.removeFile(t.id)});uploader.refresh();$("#filelist").html("<strong>Upload complete.</strong>");$("#upload-progress").css("width","0px");$(".upload-error").hide();$(".upload-error .notify-inner").html("");$("#uploadfiles").hide();$("#custom-sizes").hide()});$("#uploadfiles").click(function(e){uploader.start();e.preventDefault()});$("body").on("click","#cancelfile",function(e){$("#uploadfiles").hide();$(".upload-error").hide();$(".upload-error .notify-inner").html("");$("#custom-sizes").hide();$(".uploader-modal").modal("hide");$.each(uploader.files,function(e,t){uploader.removeFile(t.id)});$("#filelist").html('<span class="no-files-selected">No file selected</span>');uploader.refresh();uploader.splice();e.preventDefault()});uploader.init();$("#filedrop").hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")});$("#filedrop").bind("dragover",function(e){$(e.target).addClass("hover");e.stopPropagation();e.preventDefault()});$("#filedrop").bind("dragleave",function(e){$(e.target).removeClass("hover");e.stopPropagation();e.preventDefault()});$("#filedrop").bind("drop",function(e){$(e.target).removeClass("hover");e.stopPropagation();e.preventDefault()});if(!Modernizr.draganddrop){$("#filedrop").hide();$(".upload-or").hide()}});